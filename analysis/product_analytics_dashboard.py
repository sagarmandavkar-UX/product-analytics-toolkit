"""\nProduct Analytics Dashboard\nAuthor: Sagar Mandavkar\nDescription: Comprehensive product analytics dashboard for e-commerce data analysis\n             including conversion funnels, cohort analysis, and revenue metrics\n"""\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom datetime import datetime, timedelta\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# Set styling\nsns.set_style('whitegrid')\nplt.rcParams['figure.figsize'] = (14, 8)\n\nclass ProductAnalyticsDashboard:\n    """\n    Main class for product analytics operations\n    """\n    \n    def __init__(self, data_path):\n        """Initialize dashboard with data"""\n        self.df = pd.read_csv(data_path)\n        self.df['timestamp'] = pd.to_datetime(self.df['timestamp'])\n        self.df['date'] = self.df['timestamp'].dt.date\n        print(f"Loaded {len(self.df)} rows of data")\n        \n    def calculate_conversion_metrics(self):\n        """Calculate key conversion metrics"""\n        total_sessions = self.df['session_id'].nunique()\n        total_users = self.df['user_id'].nunique()\n        \n        # Calculate conversions\n        conversions = self.df[self.df['conversion'] == 1]['session_id'].nunique()\n        conversion_rate = (conversions / total_sessions) * 100\n        \n        # Revenue metrics\n        total_revenue = self.df['revenue'].sum()\n        avg_order_value = self.df[self.df['revenue'] > 0]['revenue'].mean()\n        \n        metrics = {\n            'Total Sessions': total_sessions,\n            'Total Users': total_users,\n            'Conversions': conversions,\n            'Conversion Rate': f"{conversion_rate:.2f}%",\n            'Total Revenue': f"${total_revenue:,.2f}",\n            'Average Order Value': f"${avg_order_value:,.2f}"\n        }\n        \n        return metrics\n    \n    def funnel_analysis(self):\n        """Analyze conversion funnel"""\n        funnel_data = {}\n        \n        # Page views\n        funnel_data['Page Views'] = self.df[self.df['event_type'] == 'page_view']['session_id'].nunique()\n        \n        # Add to cart\n        funnel_data['Add to Cart'] = self.df[self.df['event_type'] == 'add_to_cart']['session_id'].nunique()\n        \n        # Purchases\n        funnel_data['Purchase'] = self.df[self.df['event_type'] == 'purchase']['session_id'].nunique()\n        \n        # Calculate drop-off rates\n        funnel_df = pd.DataFrame({\n            'Stage': funnel_data.keys(),\n            'Sessions': funnel_data.values()\n        })\n        \n        funnel_df['Conversion_Rate'] = (funnel_df['Sessions'] / funnel_df['Sessions'].iloc[0] * 100).round(2)\n        funnel_df['Drop_Off'] = funnel_df['Conversion_Rate'].diff().fillna(0).abs()\n        \n        return funnel_df\n    \n    def cohort_analysis(self):\n        """Perform cohort analysis"""\n        # Group by user and get first purchase date\n        user_cohorts = self.df[self.df['conversion'] == 1].groupby('user_id').agg({\n            'date': 'min'\n        }).reset_index()\n        user_cohorts.columns = ['user_id', 'cohort_date']\n        \n        # Merge back with main data\n        cohort_df = self.df.merge(user_cohorts, on='user_id', how='left')\n        \n        return cohort_df\n    \n    def device_channel_analysis(self):\n        """Analyze performance by device and channel"""\n        # Device analysis\n        device_metrics = self.df.groupby('device').agg({\n            'session_id': 'nunique',\n            'conversion': 'sum',\n            'revenue': 'sum'\n        }).reset_index()\n        device_metrics['conversion_rate'] = (device_metrics['conversion'] / device_metrics['session_id'] * 100).round(2)\n        \n        # Channel analysis\n        channel_metrics = self.df.groupby('channel').agg({\n            'session_id': 'nunique',\n            'conversion': 'sum',\n            'revenue': 'sum'\n        }).reset_index()\n        channel_metrics['conversion_rate'] = (channel_metrics['conversion'] / channel_metrics['session_id'] * 100).round(2)\n        \n        return device_metrics, channel_metrics\n    \n    def plot_funnel(self, funnel_df):\n        """Visualize conversion funnel"""\n        plt.figure(figsize=(12, 6))\n        plt.subplot(1, 2, 1)\n        plt.barh(funnel_df['Stage'], funnel_df['Sessions'], color='steelblue')\n        plt.xlabel('Number of Sessions')\n        plt.title('Conversion Funnel')\n        plt.gca().invert_yaxis()\n        \n        plt.subplot(1, 2, 2)\n        plt.barh(funnel_df['Stage'], funnel_df['Conversion_Rate'], color='coral')\n        plt.xlabel('Conversion Rate (%)')\n        plt.title('Conversion Rate by Stage')\n        plt.gca().invert_yaxis()\n        \n        plt.tight_layout()\n        plt.savefig('outputs/funnel_analysis.png', dpi=300, bbox_inches='tight')\n        print("Funnel analysis chart saved!")\n        \n    def plot_revenue_trends(self):\n        """Plot revenue trends over time"""\n        daily_revenue = self.df.groupby('date')['revenue'].sum().reset_index()\n        \n        plt.figure(figsize=(14, 6))\n        plt.plot(daily_revenue['date'], daily_revenue['revenue'], marker='o', linewidth=2)\n        plt.xlabel('Date')\n        plt.ylabel('Revenue ($)')\n        plt.title('Daily Revenue Trends')\n        plt.xticks(rotation=45)\n        plt.grid(True, alpha=0.3)\n        plt.tight_layout()\n        plt.savefig('outputs/revenue_trends.png', dpi=300, bbox_inches='tight')\n        print("Revenue trends chart saved!")\n        \n    def generate_full_report(self):\n        """Generate comprehensive analytics report"""\n        print("=" * 60)\n        print("PRODUCT ANALYTICS DASHBOARD REPORT")\n        print("=" * 60)\n        \n        # Key metrics\n        print("\n1. KEY METRICS")\n        print("-" * 60)\n        metrics = self.calculate_conversion_metrics()\n        for key, value in metrics.items():\n            print(f"{key:25s}: {value}")\n        \n        # Funnel analysis\n        print("\n2. CONVERSION FUNNEL")\n        print("-" * 60)\n        funnel_df = self.funnel_analysis()\n        print(funnel_df.to_string(index=False))\n        self.plot_funnel(funnel_df)\n        \n        # Device & Channel\n        print("\n3. DEVICE PERFORMANCE")\n        print("-" * 60)\n        device_metrics, channel_metrics = self.device_channel_analysis()\n        print(device_metrics.to_string(index=False))\n        \n        print("\n4. CHANNEL PERFORMANCE")\n        print("-" * 60)\n        print(channel_metrics.to_string(index=False))\n        \n        # Visualizations\n        self.plot_revenue_trends()\n        \n        print("\n" + "=" * 60)\n        print("Report generation complete!")\n        print("=" * 60)\n\nif __name__ == "__main__":\n    # Initialize dashboard\n    dashboard = ProductAnalyticsDashboard('../data/ecommerce_data.csv')\n    \n    # Generate full report\n    dashboard.generate_full_report()
